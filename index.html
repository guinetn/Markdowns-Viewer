<!DOCTYPE html>
<html>
<head>
    <title>MD Viewer</title>
    <meta charset="utf-8" />
    <meta name="description" content="MD files viewer">    
    <style>
      .mdDiv   { font-size: 1.1em; width: 200px; margin:5px; background: #45AEEA; color:white;  border: solid 1px grey; border-radius: 5px; text-align: center; text-overflow: ellipsis;}
      .mdLink:link, .mdLink:visited, .mdLink:hover { text-decoration: none; font-family: "Telex",sans-serif; }
      .mdLink:active { color: orange; }
      .mdDiv:hover { background: white; color: orange; }
      #mdPages { width:250px;float:left; }
      .selected { background: red;  }
    </style>    

    <script src="https://unpkg.com/showdown/dist/showdown.min.js"></script>
</head>
<body>

<div id='files'>
</div>

<div id="preview"></div>

<script>

const config = {
  directory: "md/"
}

const preview = document.querySelector("#preview");

function loadFiles() {
  fetch('mdlist.json')
    .then(res=>res.json())
      .then(data => fillList(data));    
}
function fillList(data) {
  let default_md_file = data.files[0];
  const files = document.querySelector("#files");

  data.files.forEach(f => {
    let a = document.createElement("a");
    a.setAttribute("href", "/");
    a.setAttribute("class", "mdLink");
    a.innerHTML = `<div class='mdDiv'>${f.replace(".md","")}</div>`;
    a.addEventListener("click", selectFile);
    files.appendChild(a);     
  });

}

function selectFile(event) {
  event.preventDefault();
  getFile(`${config.directory}${event.currentTarget.innerText}.md`, showMD);
}

function showMD(file, data ) {   
  preview.innerHTML = data;
  
  var converter = new showdown.Converter();
  preview.innerHTML = converter.makeHtml(data);

}

function getFile(file, callback) {

  fetch(file)
  .then(function (response) {
    if (!response.ok) {
      throw new Error(`HTTP error on ${file}. Status:${response.status}`);
    }
    return response.blob();
  })
  .then(function (myBlob) {
    var reader = new FileReader();
    var textFile = /text.*/;
    if (myBlob.type.match(textFile)) {

      reader.onload = function (event) {         
        callback(file, event.target.result);       
      };

    } else {
      console.log(`HTTP exception on ${file}`);
    }
    reader.readAsText(myBlob);
  })
  .catch(function (error) {
    console.log(`HTTP exception on ${file}. ${error}`);
  });
}

loadFiles();
</script>
    
</body>
</html>
